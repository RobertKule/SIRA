{% extends "documentation/base.html" %}

{% block content %}
<div class="space-y-8">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h1 class="text-3xl font-bold text-primary-light dark:text-primary-dark mb-2">Documentation des Endpoints API</h1>
        <p class="text-gray-600 dark:text-gray-300">
            Documentation complète des endpoints disponibles dans l'API SIRA avec exemples de requêtes et réponses.
        </p>
    </div>

    <!-- Authentification -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="bg-primary-light dark:bg-primary-dark px-6 py-4">
            <h2 class="text-xl font-semibold text-white">Authentification</h2>
            <p class="text-primary-lighter dark:text-primary-lightest text-sm">
                Gestion des tokens JWT et authentification des utilisateurs
            </p>
        </div>
        
        <div class="p-6 space-y-6">
            <!-- Login Endpoint -->
            <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-mono mr-2">POST</span>
                            /api/auth/login/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Authentification JWT avec retour des tokens d'accès et de rafraîchissement
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">PUBLIC</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Requête</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "email": "etudiant@example.com",
    "password": "motdepasse123"
}</code></pre>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Réponse (200 OK)</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "access": "eyJhbGciOiJIUz...",
    "refresh": "eyJhbGciOiJIUz...",
    "user": {
        "id": 1,
        "email": "etudiant@example.com",
        "first_name": "Jean",
        "last_name": "Dupont",
        "roles": ["ETUDIANT"],
        "profile_type": "etudiant",
        "matricule": "ET2023001"
    }
}</code></pre>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Erreurs possibles</h4>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-start">
                            <span class="inline-block px-2 py-0.5 rounded bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs font-mono mr-2">400</span>
                            <span class="text-gray-600 dark:text-gray-400">Email ou mot de passe invalide</span>
                        </li>
                        <li class="flex items-start">
                            <span class="inline-block px-2 py-0.5 rounded bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs font-mono mr-2">403</span>
                            <span class="text-gray-600 dark:text-gray-400">Compte désactivé</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Refresh Token Endpoint -->
            <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-mono mr-2">POST</span>
                            /api/auth/refresh/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Rafraîchir le token d'accès avec le token de rafraîchissement
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">AUTHENTICATED</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Requête</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "refresh": "eyJhbGciOiJIUz..."
}</code></pre>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Réponse (200 OK)</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "access": "eyJhbGciOiJIUz..."
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profil Utilisateur -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="bg-secondary-light dark:bg-secondary-dark px-6 py-4">
            <h2 class="text-xl font-semibold text-white">Profil Utilisateur</h2>
            <p class="text-secondary-lighter dark:text-secondary-lightest text-sm">
            Gestion des informations personnelles et du mot de passe
            </p>
        </div>
        
        <div class="p-6 space-y-6">
            <!-- Get Profile -->
            <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-mono mr-2">GET</span>
                            /api/me/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Récupère toutes les informations du profil utilisateur
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">AUTHENTICATED</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Headers</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-md">
                        <code class="text-sm text-gray-800 dark:text-gray-200">Authorization: Bearer &lt;access_token&gt;</code>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Réponse (200 OK)</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "id": 1,
    "email": "etudiant@example.com",
    "first_name": "Jean",
    "last_name": "Dupont",
    "roles": ["ETUDIANT"],
    "profile_type": "etudiant",
    "matricule": "ET2023001",
    "programme": "Informatique",
    "promotion": 2023
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- Update Profile -->
            <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-sm font-mono mr-2">PATCH</span>
                            /api/me/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Met à jour partiellement les informations du profil
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">AUTHENTICATED</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Champs modifiables</h4>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">first_name</span>
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">last_name</span>
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-red-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">email (non modifiable)</span>
                        </li>
                    </ul>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Exemple de requête</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "first_name": "NouveauPrénom"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- Change Password -->
            <div>
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-mono mr-2">POST</span>
                            /api/me/change-password/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Modifier le mot de passe de l'utilisateur
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">AUTHENTICATED</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Requête</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "old_password": "ancienmotdepasse",
    "new_password": "nouveaumotdepasse"
}</code></pre>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Validation</h4>
                    <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <li class="flex items-start">
                            <svg class="h-4 w-4 mt-0.5 mr-2 flex-shrink-0 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            Le nouveau mot de passe doit être différent de l'ancien
                        </li>
                        <li class="flex items-start">
                            <svg class="h-4 w-4 mt-0.5 mr-2 flex-shrink-0 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            Doit respecter les règles de complexité (min 8 caractères, etc.)
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Administration -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <div class="bg-purple-600 dark:bg-purple-800 px-6 py-4">
            <h2 class="text-xl font-semibold text-white">Administration</h2>
            <p class="text-purple-200 text-sm">
                Endpoints réservés aux administrateurs pour la gestion des comptes
            </p>
        </div>
        
        <div class="p-6 space-y-6">
            <!-- Create Student -->
            <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-mono mr-2">POST</span>
                            /api/admin/etudiants/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Crée un nouveau compte étudiant avec profil associé
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">ADMIN ONLY</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Requête</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "email": "nouvel.etudiant@example.com",
    "first_name": "Pierre",
    "last_name": "Martin",
    "password": "motdepasse123",
    "matricule": "ET2023002",
    "programme": "Informatique",
    "promotion": 2023
}</code></pre>
                    </div>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Réponse (201 Created)</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
                        <pre class="text-sm text-gray-800 dark:text-gray-200 overflow-x-auto"><code>{
    "id": 2,
    "email": "nouvel.etudiant@example.com",
    "first_name": "Pierre",
    "last_name": "Martin",
    "roles": ["ETUDIANT"],
    "profile_type": "etudiant",
    "matricule": "ET2023002"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- Create Teacher -->
            <div>
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">
                            <span class="inline-block px-2 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-mono mr-2">POST</span>
                            /api/admin/enseignants/
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">
                            Crée un nouveau compte enseignant avec profil associé
                        </p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">ADMIN ONLY</span>
                </div>

                <div class="mt-4">
                    <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">Champs spécifiques</h4>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">matricule_enseignant</span>
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">departement</span>
                        </li>
                        <li class="flex items-center">
                            <span class="inline-block w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                            <span class="text-gray-600 dark:text-gray-400">specialite</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}